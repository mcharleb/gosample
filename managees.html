<!DOCTYPE html>
<html>
<head/>
<body>
<h3 id="username"/>
<div>
<div id="managee-table"></div><div/>
</div>
<div >
<form action="/submit">
  <input type="submit" value="Submit">
</form>
</div>
<script type="text/javascript" src="jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="jquery-ui.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.2.2/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.2.2/js/tabulator.min.js"></script>
<script>
var rankEditor = function(cell, onRendered, success, cancel, editorParams){
    //cell - the cell component for the editable cell
    //onRendered - function to call when the editor has been rendered
    //success - function to call to pass the succesfully updated value to Tabulator
    //cancel - function to call to abort the edit and return to a normal cell
    //editorParams - editorParams object set in column defintion

    //create and style editor
    var editor = $("<input/>");

    //Set value of editor to the current value of the cell
    editor.val(cell.getValue());

    //set focus on the select box when the editor is selected (timeout allows for editor to be added to DOM)
    onRendered(function(){
      editor.focus();
    });

    //when the value has been set, trigger the cell to update
    editor.on("change blur", function(e){
        if (editor.val() > 0 && editor.val() <= editorParams.max) {
            success(editor.val());
            // Look for duplicates
            var column = cell.getColumn();
            var cells = column.getCells();
            var dups = [];
            cells.forEach( function(s) { 
		var num = Number(s.getData().rank);
                if (num > 0 && dups[num]) {
                    s.getElement().css({"background-color":"#aa0000"});
                    dups[num].getElement().css({"background-color":"#aa0000"});
                }
		else {
                    s.getElement().css({"background-color":""});
                    dups[num] = s;
		}
            } );
        }
        else {
            cancel();
	}
    });

    //return the editor element
    return editor;
};

//define some sample data
var tabledata = [
    {id:1, name:"Oli Bob", yn:false, rank: ""},
    {id:2, name:"Mary May", yn:false, rank: ""},
    {id:3, name:"Christine Lobowski", yn:false, rank: ""},
    {id:4, name:"Brendon Philips", yn:false, rank: ""},
    {id:5, name:"Margret Marmajuke", yn:false, rank: ""},
];

$("#managee-table").tabulator({
    //height:205, // set height of table
    fitColumns:false, //fit columns to width of table (optional)
    columns:[ //Define Table Columns
        {title:"ID", field:"id", width:45},
        {title:"Name", field:"name", width:250},
        {title:"Y/N", field:"yn", width:65, editor:true, formatter:"tickCross"},
        {title:"Rank", field:"rank", width:80, sorter:"number", editor:rankEditor, editorParams:{max:tabledata.length}},
    ],
    rowClick:function(e, row){ //trigger an alert message when the row is clicked
        alert("Row " + row.getData().id + " Clicked!!!!");
    },
});
//load sample data into the table
$("#managee-table").tabulator("setData", tabledata);
</script>
</body>
</html>
